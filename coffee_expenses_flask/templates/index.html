
{% extends 'base.html' %}
{% block content %}
<h1>Expense Log</h1>
<section class="grid">
  <form class="card" action="{{ url_for('add') }}" method="post">
    <h2>Add Expense</h2>
    <div class="form-grid">
      <label>
        <span>Date</span>
        <input type="date" name="date" required value="{{ default_date }}">
      </label>
      <label>
        <span>Amount (MXN)</span>
        <input type="number" step="0.01" name="amount" placeholder="0.00" required>
      </label>
      <label>
        <span>Type of Expense</span>
        <input type="text" name="expense_type" list="expenseTypes" placeholder="Coffee beans, Rent, Utilities…">
        <datalist id="expenseTypes">
          {% for t in expense_types %}
            <option value="{{ t }}"></option>
          {% endfor %}
        </datalist>
      </label>
      <label>
        <span>Category</span>
        <select name="category">
          <option>Business</option>
          <option>Personal</option>
        </select>
      </label>
      <label>
        <span>Recurrence</span>
          {% set opts = recurrence_options if recurrence_options is defined and recurrence_options|length > 0 else ["Variable", "Fijo"] %}
        <select name="recurrence">
          {% for opt in opts %}
            <option value="{{ opt }}">{{ opt }}</option>
          {% endfor %}
        </select>
      </label>
        
      <label>
          <span>Payment Method / Card</span>
          <select name="card">
            {% for opt in payment_options %}
              <option value="{{ opt }}">{{ opt }}</option>
            {% endfor %}
          </select>
      </label>
      <label class="span2">
        <span>Description (optional)</span>
        <textarea name="description" rows="2" placeholder="Notes…"></textarea>
      </label>
    </div>
    <button class="btn" type="submit">Add</button>
  </form>

</section>

<section class="card">
  <h2>Recent Expenses</h2>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Amount</th>
          <th>Type</th>
          <th>Category</th>
          <th>Recurrence</th>
          <th>Card</th>
          <th>Description</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for _, row in df.iterrows() %}
        <tr>
          <td>{{ row['date'] }}</td>
          <td>${{ "{:,.2f}".format(row['amount']) }}</td>
          <td>{{ row['expense_type'] }}</td>
          <td>{{ row['category'] }}</td>
          <td>{{ row.get('recurrence', '') }}</td>
          <td>{{ row['card'] }}</td>
          <td>{{ row['description'] }}</td>
          <td>
            <a class="btn small" href="{{ url_for('edit', rid=row['id']) }}">Edit</a>
            <form method="post" action="{{ url_for('delete', rid=row['id']) }}" style="display:inline" onsubmit="return confirm('Delete this expense?')">
              <button class="btn danger small" type="submit">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
        {% if df.empty %}
        <tr><td colspan="6" class="empty">No expenses yet. Add your first one!</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
