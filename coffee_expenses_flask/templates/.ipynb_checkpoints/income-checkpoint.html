{% extends 'base.html' %}
{% block content %}
<h1>Income</h1>

<form class="card" action="{{ url_for('add_income') }}" method="post">
  <h2>Add Income</h2>
  <div class="form-grid">
    <label>
      <span>Date</span>
      <input type="date" name="date" required>
    </label>
    <label>
      <span>Amount (MXN)</span>
      <input type="number" step="0.01" name="amount" required>
    </label>
    <label>
      <span>Channel</span>
      <select name="channel">
        {% for ch in income_channels %}
          <option value="{{ ch }}">{{ ch }}</option>
        {% endfor %}
      </select>
    </label>
    <label class="span2">
      <span>Description (optional)</span>
      <textarea name="description" rows="2"></textarea>
    </label>
  </div>
  <button class="btn" type="submit">Add</button>
</form>

<section class="card" style="margin-top:12px;">
  <h2>Recent Income</h2>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Channel</th>
          <th>Net Amount</th>
          <th>Description</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for _, row in df.iterrows() %}
        <tr>
          <td>{{ row['date'] }}</td>
          <td>{{ row['channel'] }}</td>
          <td>${{ "{:,.2f}".format(row['amount']) }}</td>
          <td>{{ row['description'] }}</td>
          <td>
            <a class="btn small" href="{{ url_for('income_edit', rid=row['id']) }}">Edit</a>
            <form method="post" action="{{ url_for('income_delete', rid=row['id']) }}" style="display:inline" onsubmit="return confirm('Delete this income record?')">
              <button class="btn danger small" type="submit">Delete</button>
            </form>
          </td>

        </tr>
        {% endfor %}
        {% if df.empty %}
        <tr><td colspan="8" class="empty">No income yet. Add your first record!</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
